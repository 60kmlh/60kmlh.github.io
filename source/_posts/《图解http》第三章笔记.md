---
title: 《图解http》第三章笔记
date: 2017-09-16
tags: ['http']
categories: ['笔记']
---
## HTTP报文内的HTTP信息
### HTTP报文
用于HTTP协议交互的信息被称为HTTP报文。HTTP报文本身是由多行（使用CRLF作换行符）数据构成的字符串文本。

HTTP报文大体可分为报文首部和报文实体。两者有最初出现的空行（CRLF）来划分。
### 请求报文及响应报文的结构
请求报文和响应报文的内容由以下数据组成：
* 请求行
    包含用于请求的方法，请求URI和HTTP版本。
* 状态行
    包含表明响应状态的状态码，原因短语和HTTP版本。
* 首部字段
    包含表示请求和响应的各种条件和属性的各类首部。一般有4种首部：通用首部，请求首部，响应首部，实体首部。
* 其他
    可能包含HTTP的RFC里未定义的首部。
### 编码提升传输速率
报文主体和实体主体的差异：
* 报文（message）
    是HTTP通信中的基本单位，由8位组字节流（octet sequence，其中octet为8个比特）组成，通过HTTP通信传输。
* 实体（entity）
    作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成。

HTTP报文的主体用于传输请求或响应的实体主体。

通常，报文主体等于实体主体。只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。

内容编码应指明应用在实体内容上的编码格式，并保持实体信息的原样压缩。编码后的实体由客户端负责接收和解码。

常用的内容编码有以下几种：
* gzip（GNU zip）
* compress（UNIX系统的标准压缩）
* deflate（zlib）
* identity不进行编码）
在传输大数据容量时，通过把数据分割成多块，能够让浏览器逐步显示画面。这种把主体实体分块的功能称为分块传输编码（Chunked Transfer Coding）。

分块传输编码会将实体主体分成多个部分（块）。每一块都会用十六进制来标记大小，而实体主体的最后一块会用'0(CRLF)'来标记。

使用分块传输编码的实体主体会由接收的客户端负责解码，恢复到编码之前的实体主体。
### 发送多种数据的多部分对象集合
多部分对象集合包含的对象如下：
* multipart/form-data
    在Web表单上传时使用
* multipart/byteranges
    状态码206（Partial Content，部分内容）响应报文包含了多个范围的内容时使用。
在HTTP报文中使用多部分对象集合时，需要在首部字段里加上Content-Type。

使用boundary字符串来划分多部分对象集合指明的各类实体。
### 获取部分内容的范围请求
指定范围发送的请求叫做范围请求（Range Request）。

执行范围请求时，会使用首部字段Range来指定资源是byte范围。byte范围的指定形式如下：

* 5001 ~ 10000字节
    Range: bytes=5001-10000
* 从5001字节之后到全部
    Range: bytes=5001-
* 从一开始到3000字节和5000字节到7000字节的多重范围
    bytes: -3000, 5000-7000
针对范围请求，响应会返回状态码为206 Partial Content的响应报文。

对多重范围的范围请求，响应会在首部字段标明Content-Type为multipart/byteranges后返回响应报文。

如果服务器端无法响应范围请求，则会返回状态码200 OK和完整的实体内容。
### 内容协商返回最适合的内容
内容协商（Content Negotiation）机制是指客户端和服务端就就响应的资源内容进行交涉，然后提供给客户端最为合适的资源。

内容协商会以响应资源的语言、字符集、编码方式等作为判断的基准。如以下的首部字段，可作为基准：

* Accept
* Accept-charset
* Accept-Encoding
* Accept-Language 
* Content-Language 
内容协商技术有以下三种类型：
* 服务器驱动协商（Server-driven Negotiation）
* 客户端驱动协商（Agent-driven Negotiation）
* 透明协商（Transparent Negotiation）
